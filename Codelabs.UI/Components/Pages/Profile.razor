@page "/profile"
@using Microsoft.AspNetCore.Components.Authorization
@inject IHttpContextAccessor HttpContextAccessor
@using System.Security.Claims
@inject NavigationManager NavManager

<head>
    <link rel="stylesheet" href="css/buttons.css" />
    <link rel="stylesheet" href="css/items.css" />
    <link rel="stylesheet" href="css/texts.css" />
</head>

<PageTitle>Профиль</PageTitle>

@if (IsAuthorized())
{
    @if (GetUserRole() == (int)RoleType.Buyer)
    {
        <BuyersLessons />
    }
    else if (GetUserRole() == (int)RoleType.Author)
    {
        <AuthorsProfileForAuthor />
    }
}

@code {
    protected override async Task OnInitializedAsync()
    {
        if (IsAuthorized())
        {

        }
        else 
        {
            NavManager.NavigateTo("/login");
        }
    }

    private bool IsAuthorized()
    {
        var user = HttpContextAccessor.HttpContext.User;
        return user.Identity.IsAuthenticated;
    }

    private int? GetUserRole()
    {
        if (IsAuthorized())
        {
            var user = HttpContextAccessor.HttpContext.User;
            var role = int.Parse(user.FindFirst(ClaimTypes.Role)?.Value);
            return role;
        }
        else
        {
            return null;
        }
    }
}